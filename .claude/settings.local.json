{
  "permissions": {
    "allow": [
      "Bash(git clone:*)",
      "Bash(ls:*)",
      "Bash(python -m alembic revision:*)",
      "Bash(git init:*)",
      "Bash(git remote add:*)",
      "Bash(git checkout:*)",
      "Bash(git add:*)",
      "Bash(git reset:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(findstr:*)",
      "Bash(find:*)",
      "Bash(cd:*)",
      "Bash(git -C \"d:\\apps\\lifeservicos\" branch -a)",
      "Bash(git -C \"d:\\apps\\lifeservicos\" log --oneline -10)",
      "Bash(git -C \"d:\\apps\\lifeservicos\" status)",
      "Bash(git -C \"d:\\apps\\lifeservicos\" remote -v)",
      "Bash(git -C:*)",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && git log -1 --oneline && git status\")",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && git checkout master\")",
      "Bash(git fetch:*)",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && ls -la apps/api/migrations/versions/ | tail -10\")",
      "Bash(git merge:*)",
      "Bash(docker compose:*)",
      "Bash(python -m alembic:*)",
      "Bash(cat:*)",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && pwd && ls -la\")",
      "Bash(ssh:*)",
      "Bash(scp root@72.60.158.156:/opt/lifeservicos/src/apps/api/app/routers/cases.py C:Usershelciovenancio.claudeprod_cases.py)",
      "Bash(docker-compose ps:*)",
      "Bash(docker-compose logs:*)",
      "Bash(docker exec:*)",
      "Bash(python -c:*)",
      "Bash(python fix_passwords.py:*)",
      "Bash(tasklist:*)",
      "Bash(git pull:*)",
      "Bash(scp:*)",
      "Bash(pip install:*)",
      "Bash(pnpm install)",
      "Bash(test:*)",
      "Bash(docker-compose up:*)",
      "Bash(docker-compose exec:*)",
      "Bash(curl:*)",
      "Bash(timeout /t 5 /nobreak)",
      "Bash(xargs:*)",
      "Bash(tree:*)",
      "Bash(rsync:*)",
      "Bash(pnpm install:*)",
      "Bash(pnpm run dev)",
      "Bash(netstat:*)",
      "Bash(taskkill:*)",
      "Bash(python:*)",
      "Bash(docker-compose restart:*)",
      "Bash(timeout /t 8 /nobreak)",
      "Bash(chmod:*)",
      "Bash(powershell.exe -ExecutionPolicy Bypass -File restore-life-mobile.ps1)",
      "Bash(if [ -d \"_life-mobile\" ])",
      "Bash(then mv _life-mobile life-mobile)",
      "Bash(elif [ -d \"life-mobile\" ])",
      "Bash(then echo \"ℹ️  Diretório life-mobile já está ativo\")",
      "Bash(else echo \"⚠️  Nenhum diretório encontrado\")",
      "Bash(fi)",
      "Bash(npx expo start:*)",
      "Bash(docker logs lifeservicos-api-1 --tail 50)",
      "Bash(docker logs:*)",
      "Bash(docker ps:*)",
      "Bash(timeout /t 10 /nobreak)",
      "Bash(ipconfig:*)",
      "Bash(powershell -Command:*)",
      "Bash(powershell:*)",
      "Bash(arp:*)",
      "Bash(docker-compose down:*)",
      "Bash(cmd //c \"taskkill /F /PID 15248\")",
      "Bash(cmd //c \"taskkill /F /PID 14720\")",
      "Bash(docker-compose:*)",
      "Bash(pnpm run build:*)",
      "Bash(pnpm build:*)",
      "Bash(tar czf:*)",
      "Bash(git rm:*)",
      "Bash(mkdir:*)",
      "Bash(docker cp:*)",
      "Bash(timeout 10 python:*)",
      "Bash(git stash:*)",
      "Bash(grep:*)",
      "Bash(npx eas-cli build:*)",
      "Bash(timeout:*)",
      "Bash(npx expo install:*)",
      "Bash(npx expo prebuild:*)",
      "Bash(npx expo run:android:*)",
      "Bash(npx eas-cli:*)",
      "Bash(java -version:*)",
      "Bash(./gradlew:*)",
      "Bash(export JAVA_HOME=\"C:/Program Files/Android/Android Studio/jbr\")",
      "Bash(export PATH=\"$JAVA_HOME/bin:$PATH\")",
      "Bash(export JAVA_HOME=\"/c/Program Files/Android/Android Studio/jbr\")",
      "Bash(powershell.exe -ExecutionPolicy Bypass -File build-apk.ps1)",
      "Bash(powershell.exe -ExecutionPolicy Bypass -File build-apk-gradle.ps1)",
      "Bash(node --version:*)",
      "Bash(powershell.exe:*)",
      "Bash(if not exist \"d:\\apps\\lifeservicos\\backups\" mkdir \"d:\\apps\\lifeservicos\\backups\")",
      "Bash(dir:*)",
      "Bash(docker build:*)",
      "Bash(docker save:*)",
      "Bash(Função helper cacheada que executa as queries pesadas para filtros.)",
      "Bash(OTIMIZAÇÃO: Reduz queries complexas durante limitação de CPU.)",
      "Bash(\"\"\"\n    print(\"\"[FILTERS] Executando queries no banco (cache miss)...\"\")\n    \n    # Queries otimizadas - remover contagens para acelerar\n    # Apenas listar valores únicos, frontend pode fazer contagem local se necessário\n    \n    # 1. Bancos únicos (simplificado)\n    bancos_raw = db.query(PayrollLine.entity_name).filter(\n        PayrollLine.entity_name.isnot(None)\n    ).distinct().limit(100).all()  # Limitar para acelerar\n    \n    bancos_list = []\n    seen_banks = set()\n    for (bank,) in bancos_raw:\n        if bank and bank not in seen_banks:\n            normalized = normalize_bank_name(bank)\n            if normalized not in seen_banks:\n                bancos_list.append({\n                    \"value\": normalized,\n                    \"label\": normalized,\n                    \"count\": 0  # Desabilitar contagem por performance\n                })\n                seen_banks.add(normalized)\n    \n    # 2. Cargos únicos (simplificado)\n    cargos_raw = db.query(Client.cargo).filter(\n        Client.cargo.isnot(None),\n        Client.cargo != ''''\n    ).distinct().limit(50).all()\n    \n    cargos_list = []\n    for (cargo,) in cargos_raw:\n        if cargo:\n            cargos_list.append({\n                \"value\": cargo,\n                \"label\": cargo,\n                \"count\": 0  # Desabilitar contagem por performance\n            })\n    \n    # 3. Status únicos (usar lista padrão)\n    default_statuses = {\n        \"novo\": \"Novo\",\n        \"em_atendimento\": \"Em Atendimento\",\n        \"calculista_pendente\": \"Calculista Pendente\",\n        \"calculo_aprovado\": \"Cálculo Aprovado\",\n        \"calculo_rejeitado\": \"Cálculo Rejeitado\",\n        \"fechamento_pendente\": \"Fechamento Pendente\",\n        \"fechamento_aprovado\": \"Fechamento Aprovado\",\n        \"financeiro_pendente\": \"Financeiro Pendente\",\n        \"contrato_efetivado\": \"Contrato Efetivado\",\n        \"devolvido_financeiro\": \"Devolvido Financeiro\",\n        \"caso_cancelado\": \"Cancelado\",\n        \"encerrado\": \"Encerrado\",\n        \"sem_contato\": \"Sem Contato\",\n        \"arquivado\": \"Arquivado\",\n    }\n    \n    status_list = [\n        {\n            \"value\": k,\n            \"label\": v,\n            \"count\": 0  # Desabilitar contagem por performance\n        }\n        for k, v in default_statuses.items()\n    ]\n    \n    print(f\"\"[FILTERS] Resultado: {len(bancos_list)} bancos, {len(cargos_list)} cargos, {len(status_list)} status\"\")\n    \n    return {\n        \"bancos\": sorted(bancos_list, key=lambda x: x[\"\"label\"\"]),\n        \"cargos\": sorted(cargos_list, key=lambda x: x[\"\"label\"\"]),\n        \"status\": status_list\n    }\n\n''''''\n\n# Inserir antes do endpoint\ncontent = content.replace(marker, helper_function + ''\\n'' + marker)\n\n# Escrever de volta\nwith open(''clients.py'', ''w'', encoding=''utf-8'') as f:\n    f.write(content)\n\nprint(''✅ Função helper cacheada adicionada'')\nPYEOF\")",
      "Bash(eas init:*)",
      "Bash(if exist android rmdir /s /q android)",
      "Bash(npm install:*)",
      "Bash(npx expo install --fix)",
      "Bash(npx:*)",
      "Bash(identify:*)",
      "Bash(ip addr:*)",
      "Bash(echo \"Execute como Administrador: netsh advfirewall firewall add rule name=\"\"Backend Life System\"\" dir=in action=allow protocol=TCP localport=8000\")",
      "Bash(ss:*)",
      "Bash(ssh -o StrictHostKeyChecking=no -o ConnectTimeout=10 root@72.60.158.156 'echo \"\"=== CONEXÃO ESTABELECIDA ===\"\" && hostname && uptime')",
      "Bash(ssh -o StrictHostKeyChecking=no root@72.60.158.156 'echo \"\"=== CONECTADO ===\"\" && hostname && uptime')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== INFORMAÇÕES DO SISTEMA ===\"\" && cat /etc/os-release && echo -e \"\"\\n=== MEMÓRIA ===\"\" && free -h && echo -e \"\"\\n=== DISCO ===\"\" && df -h && echo -e \"\"\\n=== PROCESSOS PRINCIPAIS ===\"\" && ps aux --sort=-%mem | head -15')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== CONTAINERS DOCKER ===\"\" && docker ps -a && echo -e \"\"\\n=== BANCO DE DADOS POSTGRESQL ===\"\" && ps aux | grep postgres | grep -v grep && echo -e \"\"\\n=== VERIFICAR SE HÁ POSTGRES EM CONTAINER ===\"\" && docker exec -it $(docker ps -q) env 2>/dev/null | grep -i postgres || echo \"\"Nenhum container com PostgreSQL\"\"')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERIFICAR BACKUPS EXISTENTES ===\"\" && docker exec src-pgbackup-1 ls -lah /backups 2>/dev/null || echo \"\"Diretório de backups não acessível no container\"\" && echo -e \"\"\\n=== VERIFICAR VOLUMES DOCKER ===\"\" && docker volume ls | grep -i backup && echo -e \"\"\\n=== INSPECIONAR VOLUMES ===\"\" && docker volume inspect $(docker volume ls -q | grep backup) 2>/dev/null || echo \"\"Nenhum volume de backup encontrado\"\"')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VARIÁVEIS DE AMBIENTE DO CONTAINER DB ===\"\" && docker exec src-db-1 env | grep -i postgres && echo -e \"\"\\n=== VERIFICAR USUÁRIOS DO BANCO ===\"\" && docker exec src-db-1 psql -U postgres -c \"\"\\du\"\" 2>/dev/null || docker exec src-db-1 psql -U lifecalling -c \"\"\\du\"\" 2>/dev/null || docker exec src-db-1 psql -U admin -c \"\"\\du\"\" 2>/dev/null || echo \"\"Tentando descobrir usuário...\"\" && echo -e \"\"\\n=== INSPECIONAR CONTAINER ===\"\" && docker inspect src-db-1 | grep -A 10 \"\"Env\"\"')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERIFICAR INTEGRIDADE DO BACKUP ===\"\" && echo \"\"1. Testar descompressão:\"\" && gunzip -t /root/backups/lifecalling_backup_20251211_185424.sql.gz && echo \"\"✅ Arquivo comprimido está íntegro\"\" && echo -e \"\"\\n2. Verificar conteúdo SQL (primeiras 30 linhas):\"\" && gunzip -c /root/backups/lifecalling_backup_20251211_185424.sql.gz | head -30 && echo -e \"\"\\n3. Contar linhas do backup:\"\" && gunzip -c /root/backups/lifecalling_backup_20251211_185424.sql.gz | wc -l')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERIFICAR TAMANHO DA APLICAÇÃO ===\"\" && du -sh /opt/lifeservicos && echo -e \"\"\\n=== CRIAR BACKUP DOS ARQUIVOS ===\"\" && tar -czf /root/backups/lifeservicos_files_$(date +%Y%m%d_%H%M%S).tar.gz /opt/lifeservicos 2>&1 | grep -v \"\"Removing leading\"\" && echo -e \"\"\\n=== BACKUP DOS ARQUIVOS CRIADO ===\"\" && ls -lah /root/backups/*.tar.gz | tail -1 && echo -e \"\"\\n=== GERAR CHECKSUM ===\"\" && md5sum /root/backups/lifeservicos_files_*.tar.gz | tail -1')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERIFICAR LOGS DO MONARX (últimas 50 linhas) ===\"\" && journalctl -u monarx-agent --no-pager -n 50 2>/dev/null || tail -50 /var/log/monarx.log 2>/dev/null || echo \"\"Logs do Monarx não encontrados em journalctl/monarx.log\"\" && echo -e \"\"\\n=== VERIFICAR VERSÃO DO NEXT.JS NA APLICAÇÃO ===\"\" && find /opt/lifeservicos -name \"\"package.json\"\" -type f -exec echo \"\"Arquivo: {}\"\" \\; -exec grep -A 2 \"\"\\\"\"next\\\"\":\"\" {} \\; 2>/dev/null | head -20')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERSÕES COMPLETAS DO CÓDIGO ATUAL ===\"\" && cat /opt/lifeservicos/src/apps/web/package.json | grep -A 1 \"\"\\\"\"react\\\"\":\"\" && echo -e \"\"\\n=== VERIFICAR SE HÁ ARQUIVOS MALICIOSOS CONHECIDOS ===\"\" && find /opt/lifeservicos/src -type f \\( -name \"\"*.php\"\" -o -name \"\"*.phtml\"\" -o -name \"\"*.suspected\"\" \\) -mtime -30 -ls 2>/dev/null | head -20 && echo -e \"\"\\n=== BUSCAR SHELLS WEB COMUNS ===\"\" && find /opt/lifeservicos/src -type f -name \"\"*.php\"\" -exec grep -l \"\"eval.*base64_decode\\|shell_exec\\|system.*\\\\\\$_\"\" {} \\; 2>/dev/null | head -10')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== LISTAR BACKUPS ANTIGOS ===\"\" && ls -lah /opt/lifeservicos/ | grep backup && echo -e \"\"\\n=== TAMANHO DOS BACKUPS ANTIGOS ===\"\" && du -sh /opt/lifeservicos/src_backup* 2>/dev/null && du -sh /root/backups/*.sql /root/backups/*.tar.gz 2>/dev/null | grep -E \"\"Oct|2025101\"\" && echo -e \"\"\\n=== TOTAL DE ESPAÇO USADO POR BACKUPS ANTIGOS ===\"\" && du -sh /opt/lifeservicos/src_backup* 2>/dev/null | awk \"\"{sum+=\\$1} END {print sum}\"\"')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== DELETAR BACKUPS ANTIGOS ===\"\" && echo \"\"1. Deletando código vulnerável (src_backup_20251017_085026)...\"\" && rm -rf /opt/lifeservicos/src_backup_20251017_085026 && echo \"\"✅ Deletado\"\" && echo -e \"\"\\n2. Deletando backups de outubro em /root/backups...\"\" && rm -f /root/backups/lifecalling_db_backup_20251010_085643.sql && rm -f /root/backups/lifeservicos_code_backup_20251010_085643.tar.gz && echo \"\"✅ Deletados\"\" && echo -e \"\"\\n3. Deletando .env.backup_deploy...\"\" && rm -f /opt/lifeservicos/.env.backup_deploy && echo \"\"✅ Deletado\"\" && echo -e \"\"\\n=== VERIFICAR ESPAÇO LIBERADO ===\"\" && df -h / | grep -E \"\"Filesystem|/dev/sda1\"\"')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== PROCESSOS SUSPEITOS ===\"\" && ps aux | grep -E \"\"nc|netcat|ncat|socat|perl.*socket|python.*socket|/tmp/\\.|bash.*dev/tcp\"\" | grep -v grep && echo -e \"\"\\n=== CONEXÕES DE REDE ESTABELECIDAS ===\"\" && ss -tunap | grep ESTAB | grep -v \"\"127.0.0.1\\|172.1\\|::1\"\" | head -20 && echo -e \"\"\\n=== PORTAS EM ESCUTA ===\"\" && ss -tunlp | grep -E \"\"LISTEN.*:(22|80|443|5432|5433)\"\" && echo -e \"\"\\n=== ARQUIVOS MODIFICADOS NAS ÚLTIMAS 48H (não docker/tmp) ===\"\" && find /opt/lifeservicos/src -type f -mtime -2 ! -path \"\"*/node_modules/*\"\" ! -path \"\"*/.git/*\"\" ! -path \"\"*/.next/*\"\" -ls 2>/dev/null | head -15')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== INCIDENT-RESPONSE-SUMMARY.md ===\"\" && cat /opt/lifeservicos/src/INCIDENT-RESPONSE-SUMMARY.md && echo -e \"\"\\n\\n=== SECURITY-INCIDENT-2025-12-10.md ===\"\" && cat /opt/lifeservicos/src/SECURITY-INCIDENT-2025-12-10.md && echo -e \"\"\\n\\n=== ANALISE-ATAQUE-MALWARE.md ===\"\" && cat /opt/lifeservicos/src/ANALISE-ATAQUE-MALWARE.md')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== VERIFICAR UFW (FIREWALL) ===\"\" && ufw status verbose && echo -e \"\"\\n=== VERIFICAR FAIL2BAN ===\"\" && fail2ban-client status && echo -e \"\"\\n=== VERIFICAR UNATTENDED-UPGRADES ===\"\" && systemctl status unattended-upgrades --no-pager -l | head -15')",
      "Bash(ssh root@72.60.158.156 'echo \"\"=== SAÚDE DOS CONTAINERS ===\"\" && docker ps -a --format \"\"table {{.Names}}\\t{{.Status}}\\t{{.Image}}\"\" && echo -e \"\"\\n=== VERIFICAR LOGS DE ERRO ===\"\" && docker logs src-api-1 --tail 20 2>&1 | tail -10 && echo -e \"\"\\n=== VERIFICAR HEALTH DO BANCO ===\"\" && docker inspect src-db-1 --format=\"\"{{.State.Health.Status}}\"\"')",
      "Bash(ssh root@72.60.158.156:*)",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && docker compose ps\")",
      "Bash(ssh root@72.60.158.156 \"docker images | grep src-web\")",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && docker compose logs web --tail 50 2>&1\")",
      "Bash(ssh root@72.60.158.156 \"docker images | head -20\")",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && docker compose build web 2>&1 | tail -100\")",
      "Bash(ssh root@72.60.158.156 \"docker images | grep -E ''src-web|lifeservicos-web'' && echo ''---'' && cd /opt/lifeservicos/src && docker compose up -d web && sleep 10 && docker compose ps && docker compose logs web --tail 30\")",
      "Bash(ssh root@72.60.158.156 \"docker run --rm lifeservicos-web cat /app/package.json 2>/dev/null | grep -A2 ''\"\"next\"\"'' || docker run --rm lifeservicos-web cat /app/apps/web/package.json 2>/dev/null | grep -A2 ''\"\"next\"\"''\")",
      "Bash(pkill -f \"ssh root@72.60.158.156\")",
      "Bash(ssh root@72.60.158.156 \"docker tag lifeservicos-web:latest src-web:latest && cd /opt/lifeservicos/src && docker compose up -d web\")",
      "Bash(ssh root@72.60.158.156 \"cd /opt/lifeservicos/src && docker compose ps && echo ''---LOGS---'' && docker compose logs web --tail 20\")",
      "Bash(git rebase:*)",
      "Bash(ssh root@72.60.158.156 'cd /opt/lifeservicos/src && cp proxy/Caddyfile.backup proxy/Caddyfile && echo \"\"Caddyfile restaurado com sucesso\"\" && ls -lh proxy/Caddyfile*')",
      "Bash(tar:*)",
      "Bash(ssh root@72.60.158.156 'docker ps --format \"\"table {{.Names}}\\t{{.Status}}\"\" && echo \"\"---API HEALTH---\"\" && curl -s http://localhost:8000/health || echo \"\"API não responde\"\"')",
      "Bash(git submodule:*)",
      "Bash(if [ -f .env ])",
      "Bash(then echo \"=== .env ===\")",
      "Bash(elif [ -f .env.local ])",
      "Bash(then echo \"=== .env.local ===\")",
      "Bash(else echo \"Nenhum arquivo .env encontrado\")",
      "Bash(ssh root@72.60.158.156 \"docker exec src-web-1 npx fix-react2shell-next\")",
      "Bash(ssh root@72.60.158.156 \"docker exec src-web-1 npx fix-react2shell-next --fix\")"
    ],
    "deny": [],
    "ask": []
  }
}
