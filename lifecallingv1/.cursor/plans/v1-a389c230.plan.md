<!-- a389c230-4cac-44ed-b267-5384e1830a7b 81a42ae6-e61b-4d9d-af93-b2a8bd9ef93f -->
# Atualização v1 - Life Digital

## 1. Setup e Organização

### 1.1 Criar branch de desenvolvimento

- Criar branch `feature/v1-updates` a partir de `main`
- Garantir sincronização com repositório remoto

## 2. Ajustes de Título e Branding

### 2.1 Alterar título da aplicação

- **Arquivo**: `lifecalling/apps/web/src/app/layout.tsx` (linha 13)
- Alterar `title: "Lifecalling"` para `title: "Life Digital"`

## 3. Novo Módulo FAQ e Boas Práticas

### 3.1 Criar página FAQ

- **Arquivo**: `lifecalling/apps/web/src/app/faq/page.tsx` (novo)
- Criar página estática com:
- Seções de Perguntas Frequentes
- Diagrama de fluxo MVP da aplicação
- Guia de boas práticas por tipo de usuário
- Design didático e responsivo

### 3.2 Adicionar rota ao middleware

- **Arquivo**: `lifecalling/apps/web/src/middleware.ts` (linha 4-15)
- Adicionar `/faq` ao RBAC permitindo acesso a todos os roles

### 3.3 Adicionar ao menu lateral

- **Arquivo**: Verificar `lifecalling/apps/web/src/components/shell/Sidebar.tsx`
- Adicionar item de menu "FAQ & Boas Práticas"

## 4. Correções no Módulo Usuários

### 4.1 Corrigir cadastro de usuários (Backend)

- **Arquivo**: `lifecalling/apps/api/app/routers/users.py` (linhas 102-150)
- Verificar e corrigir endpoint POST `/users`
- Adicionar logs para debug
- Validar criação de hash de senha

### 4.2 Corrigir dados de performance (Backend)

- **Arquivo**: `lifecalling/apps/api/app/routers/users.py` (linhas 265-307)
- Corrigir endpoint `/users/performance`
- Verificar queries de contratos efetivados e produção total
- Garantir retorno correto de dados

### 4.3 Atualizar Frontend

- **Arquivo**: `lifecalling/apps/web/src/app/usuarios/page.tsx` (linhas 186-199)
- Verificar mapeamento de dados de performance
- Adicionar tratamento de erro melhorado
- Adicionar logs no console para debug

## 5. Botões de Exclusão

### 5.1 Melhorar exclusão de cliente

- **Arquivo**: `lifecalling/apps/web/src/app/clientes/[id]/page.tsx` (linhas 62-82)
- Adicionar funcionalidade de exclusão em cascata
- Criar modal de confirmação listando casos vinculados
- Permitir exclusão de casos junto com cliente

### 5.2 Backend - Exclusão em cascata

- **Arquivo**: `lifecalling/apps/api/app/routers/clients.py` (criar/verificar)
- Criar endpoint DELETE com opção de cascata
- Validar permissões (apenas admin)
- Implementar lógica de exclusão de casos relacionados

## 6. Ajustes no Módulo Atendimento (Casos)

### 6.1 Adicionar comentário no card de resultados

- **Arquivo**: `lifecalling/apps/web/src/app/casos/[id]/page.tsx` (linha 662-670)
- Comentários já existem como "Observações"
- Verificar salvamento no backend

### 6.2 Adicionar Consultoria Líquida ao card resultado

- **Arquivo**: `lifecalling/packages/ui/src/SimulationResultCard.tsx` (linha 199-206)
- Campo já existe e está exibido
- Verificar se está aparecendo corretamente

## 7. Verificar Rotas por Role

### 7.1 Revisar middleware RBAC

- **Arquivo**: `lifecalling/apps/web/src/middleware.ts` (linhas 4-25)
- Validar mapeamento de rotas por role
- Corrigir rota padrão do atendente (linha 21)
- Adicionar testes de redirecionamento

### 7.2 Validar redirecionamento no login

- **Arquivo**: `lifecalling/apps/web/src/lib/auth.tsx` (linhas 131-156)
- Verificar lógica de redirecionamento por role
- Garantir consistência com middleware

## 8. Campo Observação do Calculista

### 8.1 Adicionar campo no modelo (Backend)

- **Arquivo**: `lifecalling/apps/api/app/models.py` (linha 122-150)
- Adicionar campo `observacao_calculista` na tabela `simulations`
- Tipo: `Column(Text, nullable=True)`

### 8.2 Criar migração

- Criar migration com Alembic para adicionar campo
- Arquivo: `lifecalling/apps/api/app/migrations/versions/[timestamp]_add_observacao_calculista.py`

### 8.3 Atualizar schemas (Backend)

- **Arquivo**: `lifecalling/apps/api/app/routers/simulations.py`
- Adicionar `observacao_calculista` no SimulationInput
- Incluir no salvamento (linha 208-223)
- Incluir no histórico (linha 341-356)

### 8.4 Adicionar campo no formulário (Frontend)

- **Arquivo**: `lifecalling/apps/web/src/app/calculista/[caseId]/page.tsx`
- Adicionar textarea para observações após os resultados
- Estado para controlar valor
- Enviar junto com simulação

### 8.5 Exibir no histórico

- **Arquivo**: `lifecalling/packages/ui/src/SimulationHistoryModal.tsx`
- Adicionar exibição de observações em cada entrada do histórico
- Permitir visualização completa

## 9. Melhorias no Módulo Calculista

### 9.1 Adicionar tab "Todas Simulações"

- **Arquivo**: `lifecalling/apps/web/src/app/calculista/page.tsx` (linha 327-346)
- Adicionar nova TabsTrigger "Todas Simulações"
- Ajustar grid para 7 colunas

### 9.2 Criar componente de busca

- Adicionar Input de busca por Nome ou CPF
- Implementar filtro client-side
- Exibir todas as simulações (não apenas de hoje)

### 9.3 Backend - Endpoint todas simulações

- **Arquivo**: `lifecalling/apps/api/app/routers/simulations.py` (linha 39-167)
- Modificar endpoint GET `/simulations` para aceitar parâmetro `all=true`
- Remover filtro de data quando solicitado

## 10. Ajuste de Nomenclatura

### 10.1 Atualizar PodiumCard

- **Arquivo**: `lifecalling/packages/ui/src/PodiumCard.tsx` (linha 122)
- Label já está como "Consultoria Líquida"
- Verificar se está correto em todos os usos

## 11. Correções no Módulo Fechamento

### 11.1 Identificar o problema

- **KPI "Casos Pendentes"** mostra casos com status `calculo_aprovado` E `fechamento_pendente`
- **Arquivo**: `lifecalling/apps/api/app/routers/closing.py` (linhas 326-328)
- A fila do fechamento (`/closing/queue`) mostra apenas `fechamento_pendente`, `fechamento_aprovado`, `fechamento_reprovado`
- **Arquivo**: `lifecalling/apps/api/app/routers/closing.py` (linha 22)
- **PROBLEMA**: Casos com status `calculo_aprovado` estão sendo contados no KPI mas não aparecem na esteira

### 11.2 Melhorar descrição do KPI

- **Arquivo**: `lifecalling/apps/web/src/app/fechamento/page.tsx` (linhas 218-228)
- Alterar subtitle de "Aguardando análise" para "Aguardando envio do atendente"
- Adicionar tooltip explicativo: "Casos aprovados pelo calculista que ainda não foram enviados para fechamento pelo atendente"

### 11.3 Criar nova tab para casos aguardando envio (OPCIONAL)

- **Decisão**: Verificar se faz sentido criar uma tab separada mostrando casos em `calculo_aprovado`
- Estes casos pertencem ao módulo de atendimento (esteira), não ao fechamento
- Alternativa: Melhorar apenas a descrição do KPI para deixar claro o status

### 11.4 Validar fluxo de envio

- **Arquivo**: `lifecalling/apps/web/src/app/casos/[id]/page.tsx`
- Verificar se botão "Enviar para Fechamento" está visível e funcionando
- Garantir que atendentes veem claramente quando devem enviar casos

## 12. Testes e Validação

### 11.1 Testes funcionais

- Testar criação de usuários
- Testar exclusão de clientes com casos
- Testar campo observação em simulações
- Testar busca em todas simulações
- Testar redirecionamento por role

### 11.2 Testes de UI

- Verificar responsividade da página FAQ
- Validar exibição de dados de performance
- Confirmar nomenclaturas corretas

### 11.3 Testes de integração

- Validar fluxo completo de simulação com observações
- Testar permissões de exclusão
- Verificar histórico de simulações

## 12. Documentação e Finalização

### 12.1 Atualizar documentação

- Documentar novo módulo FAQ
- Documentar campo de observações
- Atualizar guia de permissões

### 12.2 Preparar para merge

- Revisar todos os commits
- Criar PR detalhado
- Solicitar code review

### To-dos

- [ ] Criar branch feature/v1-updates e sincronizar
- [ ] Alterar título da aplicação para Life Digital
- [ ] Criar módulo FAQ e Boas Práticas com conteúdo estático
- [ ] Corrigir endpoint de criação de usuários e performance no backend
- [ ] Corrigir exibição de dados de performance no frontend
- [ ] Implementar exclusão em cascata de clientes com casos vinculados
- [ ] Revisar e corrigir redirecionamento de rotas por role
- [ ] Adicionar campo observacao_calculista no modelo e criar migração
- [ ] Atualizar endpoints de simulação para incluir observações
- [ ] Adicionar campo de observações no formulário e histórico
- [ ] Criar tab Todas Simulações com busca por Nome/CPF
- [ ] Atualizar endpoint backend para retornar todas simulações
- [ ] Executar testes funcionais e validação completa